# Практическая работа №4. Моделирование биоклиматической комфортности в городской среде

### Часть 1. Работа с моделью микромасштабной моделью RayMan
В рамках практической работы необходимо:
* Конвертировать данные реанализа или наблюдений для вашего города (для периода продолжительностью 1 месяц) для теплого времени года в формат форсинга, требуемый для модели RayMan. Пример входного файла в требуемом формате: [Moscow_VDNKh_2010.txt](https://github.com/mvarentsov/Urban-climate-modelling4HSE/blob/main/Practice/PW4_data/Moscow_VDNKh_2010.txt )
    - При работе с данными наблюдений с сайта "Погода и климат" при этом будет необходимо "извлечь" численные значения скорости ветра и балла облачности из текстовых ячеек таблицы
    - Если данные наблюдений о температуре поверхности не доступны, ее можно задать равной температуре воздуха, не задавать вовсе (будет то же самое) или задать по данным реанализа
    - При работе с данным реанализа необходимо конвертировать температуру точки росы в относительную влажность, используя формулу Магнуса (используйте знания из курса "Атмосфера" и пример кода для Matlab на скриншоте ниже).
    - Вне зависимости от источника данных, необходимо привести скорость ветра со стандартной высоты 10 м на уровень 1.1. м по логарифмическому профилю. Параметр шероховатости z0 выбирайте экспертным образом (гугл в помощь).
    - ![image](https://github.com/mvarentsov/Urban-climate-modelling4HSE/assets/67764064/9fc89170-ca4a-4829-9cb2-fca5aa972a6e)

* Запустить модель RayMan ([исполняемый файл под Windows](https://github.com/mvarentsov/Urban-climate-modelling4HSE/blob/main/Practice/Soft/RayManPro.zip)), задать координаты вашего города, открыть файл с форсингом. 
* Выполнить модельный расчет индексов термического комфорта для открытой площадки (без застройки)
* Сравнить в формате графиков временную динамику температуры воздуха, радиационной температуры (MRT) и индексов UTCI, PET, mPET
* Повторить расчеты, изменив физиологические параметры человека (пол/возраст, уровень физической активности) и/или параметры одежды, сравнить результаты
* Сконфигурировать в RayMan фрагмент городской среды выбранного города (задать несколько зданий), используя данные OpenStreetMap. Препятствия в RayMan можно задавать вручную или использовать плагин [Shp to Obs](https://www.urbanclimate.net/rayman/ShpToObs.html) для QGIS.
* Выполнить модельный расчет индексов термического комфорта для точки в окружении застройки
* Сравнить в формате графиков результаты расчетов для открытой площадки и точки в окружении застройки
* Выделить моменты времени с различными градациями теплового стресса по индексам PET и UTCI. Критерии выделения различных градаций теплового стресса доступны, например, в таблице S2 в Suplimentary Materials к статье [(Konstantinov et al, 2022)](https://iopscience.iop.org/article/10.1088/1748-9326/ac7fa9)
![image](https://github.com/mvarentsov/Urban-climate-modelling4HSE/assets/67764064/38bd1359-a449-47ab-8c52-319bd46e45db)

**Справка:** Модель «RayMan» разработана для расчета потоков коротковолнового и длинноволнового излучения, воздействующего на организм человека, в городской среде, и расчета c их учетом индексов термического комфорта UTCI и PET на базе стандартных метеорологических величин. Описание модели приведено в статьях ([Matzarakis et al., 2007](https://link.springer.com/article/10.1007/s00484-006-0061-8),[Matzarakis et al., 2010](https://link.springer.com/article/10.1007/s00484-009-0261-0)) и в документации на [сайте модели](https://www.urbanclimate.net/rayman/).

![image](https://github.com/mvarentsov/Urban-climate-modelling4HSE/assets/67764064/8d37d99d-4af3-4e34-b6d5-50aa651d667a)


### Часть 2. Раcчет индексов термического комфорта в Python

* Выполнить расчет индексов термического комфорта для вашего города для открытой площадки (без застройки) с использованием библиотеки [biometeo](https://pypi.org/project/biometeo/0.2.1/)  для python [([Yung‑Chang Chen, 2023])](https://www.nature.com/articles/s41598-023-47388-y), по тому же набору данных, который использовался в RayMan.
  </br>Пример работы с библиотеой biometeo: [PW4_example.ipynb](https://github.com/mvarentsov/Urban-climate-modelling4HSE/blob/main/Practice/PW4_example.ipynb)
* Сравнить в формате графиков и диаграмм рассеяния результаты расчетов MRT, PET и/или UTCI, а также суммарной солнечной радиации (global radiation) средствами biometeo и RayMan 
* Выполнить расчет индексов термического комфорта с использованием библиотеки biometeo  для python по данным реанализа ERA5:
    - За период не менее 1 года
    - в качестве радиационного форсинга использовать не балл облачности, а радиационные потоки (задать для функции Tmrt_calc параметры G (global radiation in W/m2), DGratio (ratio of diffuse and global radiationб dimensionless). 
* Выполнитель дополнительный расчет по тем же данным, изменив радиационные свойства поверхности или человека. Например, можно изменитьальбедо поверхности (нужно задать параметр alb для функции Tmrt_calc).
* Сравнить результаты двух расчетов для MRT и PET
* Построить диаграмму повторяемости градаций термического стресса  по индексу PET за рассматриваемый период по аналогии с примером ниже, источник - статья [(Maratkanova, Konstantinov, 2023)](https://aseestant.ceon.rs/index.php/geopan/article/view/47297/24343).

* ![image](https://github.com/mvarentsov/Urban-climate-modelling4HSE/assets/67764064/0fbeaf46-b704-4725-87f1-0d829f114556)
